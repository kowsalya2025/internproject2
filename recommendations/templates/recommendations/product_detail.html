{% extends 'recommendations/base.html' %}
{% load static %}

{% block content %}
<style>
    .product-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 48px;
        margin-bottom: 64px;
    }

    .product-image-section {
        position: sticky;
        top: 120px;
        height: fit-content;
    }

    .main-image {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        width: 100%;
        height: 550px;
        border-radius: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 140px;
        box-shadow: 0 24px 60px rgba(99, 102, 241, 0.3);
        position: relative;
        overflow: hidden;
    }

    .main-image::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: rotate(45deg);
        animation: shimmer 3s infinite;
    }

    .product-badge {
        position: absolute;
        top: 24px;
        right: 24px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        padding: 12px 28px;
        border-radius: 50px;
        font-size: 16px;
        font-weight: 800;
        color: var(--primary);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .thumbnail-gallery {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-top: 24px;
    }

    .thumbnail {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        height: 120px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        border: 3px solid transparent;
    }

    .thumbnail:hover {
        border-color: var(--primary);
        transform: scale(1.05);
    }

    .product-details {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 48px;
        border-radius: 32px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
    }

    .product-name {
        font-family: 'Poppins', sans-serif;
        font-size: 42px;
        font-weight: 900;
        margin-bottom: 20px;
        color: var(--dark);
        line-height: 1.2;
    }

    .product-rating-row {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
        flex-wrap: wrap;
    }

    .rating-display {
        color: #f59e0b;
        font-size: 20px;
        font-weight: 800;
    }

    .review-count {
        color: #94a3b8;
        font-size: 16px;
        font-weight: 600;
    }

    .stock-badge {
        background: var(--success);
        color: #fff;
        padding: 8px 20px;
        border-radius: 50px;
        font-size: 14px;
        font-weight: 800;
    }

    .price-section {
        margin-bottom: 32px;
        padding-bottom: 32px;
        border-bottom: 2px solid #e2e8f0;
    }

    .product-price {
        font-size: 56px;
        font-weight: 900;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 12px;
    }

    .shipping-notice {
        color: var(--success);
        font-size: 16px;
        font-weight: 800;
    }

    .product-section {
        margin-bottom: 32px;
    }

    .section-heading {
        font-size: 20px;
        font-weight: 800;
        margin-bottom: 16px;
        color: var(--dark);
    }

    .description-text {
        color: #64748b;
        font-size: 16px;
        line-height: 1.8;
    }

    .features-list {
        display: grid;
        gap: 12px;
    }

    .feature-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: #f8fafc;
        border-radius: 16px;
    }

    .feature-icon {
        font-size: 24px;
    }

    .feature-text {
        font-size: 15px;
        color: #475569;
        font-weight: 600;
    }

    .action-buttons {
        display: grid;
        grid-template-columns: 2fr 2fr 1fr;
        gap: 16px;
        margin-bottom: 32px;
    }

    .btn-add-cart {
        padding: 20px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #fff;
        text-align: center;
        text-decoration: none;
        border-radius: 16px;
        font-weight: 900;
        font-size: 17px;
        box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
        transition: all 0.3s;
        border: none;
        cursor: pointer;
    }

    .btn-add-cart:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(99, 102, 241, 0.6);
    }

    .btn-buy-now {
        padding: 20px;
        background: var(--success);
        color: #fff;
        text-align: center;
        text-decoration: none;
        border-radius: 16px;
        font-weight: 900;
        font-size: 17px;
        box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        transition: all 0.3s;
    }

    .btn-buy-now:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(16, 185, 129, 0.6);
    }

    .btn-wishlist {
        padding: 20px;
        background: #fff;
        border: 3px solid #e2e8f0;
        border-radius: 16px;
        font-size: 28px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .btn-wishlist:hover {
        background: #ffe4e6;
        border-color: var(--secondary);
        transform: scale(1.1);
    }

    .trust-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        padding: 24px;
        background: #f8fafc;
        border-radius: 20px;
    }

    .trust-item {
        text-align: center;
    }

    .trust-icon {
        font-size: 32px;
        margin-bottom: 8px;
    }

    .trust-label {
        font-size: 13px;
        font-weight: 800;
        color: #475569;
    }

    .rating-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 48px;
        border-radius: 32px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 64px;
    }

    .rating-title {
        font-family: 'Poppins', sans-serif;
        font-size: 32px;
        font-weight: 900;
        margin-bottom: 24px;
        color: var(--dark);
    }

    .user-rating-status {
        color: var(--success);
        font-size: 17px;
        margin-bottom: 24px;
        font-weight: 700;
    }

    .star-rating-form {
        display: flex;
        gap: 24px;
        align-items: center;
    }

    .star-group {
        display: flex;
        gap: 12px;
    }

    .star-label {
        cursor: pointer;
        font-size: 48px;
        transition: all 0.2s;
    }

    .star-label:hover {
        transform: scale(1.2);
    }

    .star-radio:checked + .star-label {
        color: #f59e0b;
    }

    .submit-rating-btn {
        padding: 16px 36px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #fff;
        border: none;
        border-radius: 50px;
        font-weight: 800;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);
        transition: all 0.3s;
    }

    .submit-rating-btn:hover {
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 24px rgba(99, 102, 241, 0.6);
    }

    .reviews-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 48px;
        border-radius: 32px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 64px;
    }

    .reviews-title {
        font-family: 'Poppins', sans-serif;
        font-size: 32px;
        font-weight: 900;
        margin-bottom: 32px;
        color: var(--dark);
    }

    .review-item {
        padding: 32px;
        background: #f8fafc;
        border-radius: 20px;
        border-left: 5px solid var(--primary);
        margin-bottom: 24px;
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        flex-wrap: wrap;
        gap: 12px;
    }

    .reviewer-name {
        font-weight: 800;
        font-size: 18px;
        color: var(--dark);
        margin-bottom: 8px;
    }

    .review-stars {
        color: #f59e0b;
        font-size: 20px;
        font-weight: 800;
    }

    .review-date {
        color: #94a3b8;
        font-size: 15px;
        font-weight: 600;
    }

    .review-text {
        color: #475569;
        font-size: 16px;
        line-height: 1.7;
    }

    .empty-reviews {
        text-align: center;
        padding: 48px;
        background: #f8fafc;
        border-radius: 24px;
    }

    .empty-reviews-icon {
        font-size: 64px;
        margin-bottom: 20px;
    }

    .empty-reviews-title {
        font-size: 24px;
        font-weight: 900;
        margin-bottom: 12px;
        color: var(--dark);
    }

    .empty-reviews-text {
        color: #64748b;
        font-size: 16px;
    }

    @media (max-width: 992px) {
        .product-layout {
            grid-template-columns: 1fr;
        }
        .product-image-section {
            position: static;
        }
        .action-buttons {
            grid-template-columns: 1fr;
        }
    }

/* Heart button container */
.btn-wishlist {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 2px solid #e5e7eb;
    background-color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: #e5e7eb; /* gray heart by default */
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

/* Hover effect */
.btn-wishlist:hover {
    transform: scale(1.2);
    color: #ff4d6d; /* pink heart on hover */
    background-color: #ffe4e6;
    border-color: #ff4d6d;
}

/* Active state when added to wishlist */
.btn-wishlist.active {
    background-color: #ff4d6d;
    color: #fff;
    border-color: #ff4d6d;
    box-shadow: 0 4px 12px rgba(255, 77, 109, 0.4);
    transform: scale(1.2);
}

.product-image {
    width: 100%;
    height: 220px;              /* fixed height */
    overflow: hidden;
    border-radius: 16px;
    background: #f3f4f6;
    display: flex;
    align-items: center;
    justify-content: center;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;          /* üî• fixes stretching */
    border-radius: 16px;
}



</style>

<div class="product-layout">
    <!-- Product Images -->
    <div class="product-image-section">
       <div class="main-image">
    <img id="mainProductImage"
         src="{{ product.image.url }}"
         alt="{{ product.name }}"
         style="width:100%; height:100%; object-fit:cover; border-radius:32px;">
</div>

<div class="thumbnail-gallery">
    {% if product.image %}
        {% for i in "1234" %}
        <div class="thumbnail" onclick="changeImage('{{ product.image.url }}')">
            <img src="{{ product.image.url }}"
                 alt="{{ product.name }}"
                 style="width:100%; height:100%; object-fit:cover; border-radius:16px;">
        </div>
        {% endfor %}
    {% endif %}
</div> 
    </div>


    <!-- Product Details -->
    <div class="product-details">
        <h1 class="product-name">{{ product.name }}</h1>

        <div class="product-rating-row">
            <div class="rating-display">‚≠ê {{ product.average_rating|floatformat:1 }}</div>
            <div class="review-count">({{ product.rating_count }} reviews)</div>
            <div class="stock-badge">In Stock</div>
        </div>

        <div class="price-section">
            <div class="product-price">${{ product.price }}</div>
            <div class="shipping-notice">‚úì Free shipping on this item</div>
        </div>

        <div class="product-section">
            <h3 class="section-heading">üìù Description</h3>
            <p class="description-text">{{ product.description }}</p>
        </div>

        <div class="product-section">
            <h3 class="section-heading">‚ú® Key Features</h3>
            <div class="features-list">
                <div class="feature-item">
                    <span class="feature-icon">‚úì</span>
                    <span class="feature-text">Premium Quality Materials</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚úì</span>
                    <span class="feature-text">30-Day Money Back Guarantee</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚úì</span>
                    <span class="feature-text">Fast & Free Shipping</span>
                </div>
            </div>
        </div>

        <div class="action-buttons">
    {% if user.is_authenticated %}
        <a href="{% url 'add_to_cart' product.id %}" class="btn-add-cart">
            üõí Add to Cart
        </a>

        <a href="{% url 'toggle_wishlist' product.id %}"
   class="btn-wishlist {% if product.id in wishlist_ids %}active{% endif %}">
   ‚ù§Ô∏è
</a>


    {% else %}
        <a href="{% url 'login' %}" class="btn-add-cart">
            Login to Purchase
        </a>
    {% endif %}
</div>



       

        <div class="trust-row">
            <div class="trust-item">
                <div class="trust-icon">üöö</div>
                <div class="trust-label">Fast Delivery</div>
            </div>
            <div class="trust-item">
                <div class="trust-icon">üîí</div>
                <div class="trust-label">Secure Payment</div>
            </div>
            <div class="trust-item">
                <div class="trust-icon">‚Ü©Ô∏è</div>
                <div class="trust-label">Easy Returns</div>
            </div>
        </div>
    </div>
</div>

<!-- Rate This Product -->
{% if user.is_authenticated %}
<div class="rating-section">
    <h2 class="rating-title">‚≠ê Rate This Product</h2>
    
    {% if user_rating %}
    <p class="user-rating-status">‚úì You rated this product {{ user_rating.score }}/5 stars</p>
    {% endif %}

    <form method="POST" action="{% url 'rate_product' product.id %}" class="star-rating-form">
        {% csrf_token %}
        <div class="star-group">
            {% for i in "12345" %}
            <label>
                <input type="radio" name="score" value="{{ forloop.counter }}" 
                       {% if user_rating.score == forloop.counter %}checked{% endif %} 
                       style="display: none;" class="star-radio">
                <span class="star-label">‚≠ê</span>
            </label>
            {% endfor %}
        </div>
        <button type="submit" class="submit-rating-btn">Submit Rating</button>
    </form>
</div>
{% endif %}

<!-- Customer Reviews -->
<div class="reviews-section">
    <h2 class="reviews-title">üí¨ Customer Reviews ({{ product.rating_count }})</h2>

    {% if ratings %}
    {% for rating in ratings %}
    <div class="review-item">
        <div class="review-header">
            <div>
                <div class="reviewer-name">{{ rating.user.username }}</div>
                <div class="review-stars">
                    {% for i in "12345" %}
                        {% if forloop.counter <= rating.score %}‚≠ê{% else %}‚òÜ{% endif %}
                    {% endfor %}
                </div>
            </div>
            <div class="review-date">{{ rating.created_at|date:"M d, Y" }}</div>
        </div>
        {% if rating.review %}
        <p class="review-text">{{ rating.review }}</p>
        {% endif %}
    </div>
    {% endfor %}
    {% else %}
    <div class="empty-reviews">
        <div class="empty-reviews-icon">üí≠</div>
        <h3 class="empty-reviews-title">No Reviews Yet</h3>
        <p class="empty-reviews-text">Be the first to review this product!</p>
    </div>
    {% endif %}
</div>

<!-- Similar Products -->
{% if similar_products %}
<div>
    <div class="section-header">
        <h2 class="section-title">üîç Similar Products</h2>
    </div>

    <div class="product-grid">
        {% for product in similar_products %}
        <div class="product-card">
            <div class="product-image">
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
            </div>

            <div class="product-content">
                <span class="category">{{ product.category.name }}</span>
                <h3>{{ product.name }}</h3>
                <p>{{ product.description|truncatewords:12 }}</p>
                <div class="rating">‚≠ê {{ product.average_rating|floatformat:1 }}</div>
                <div class="price">‚Çπ{{ product.price }}</div>
                <a href="{% url 'product_detail' product.id %}" class="btn">View Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Recommended Products -->
{% if recommendations %}
<div style="margin-top: 64px;">
    <div class="section-header">
        <h2 class="section-title">üéØ Recommended For You</h2>
        <span class="section-badge">AI Powered</span>
    </div>

    <div class="product-grid">
        {% for product in recommendations %}
        <div class="product-card">
            <div class="product-image">
                <img src="{{ product.image.url }}" alt="{{ product.name }}">
            </div>

            <div class="product-content">
                <span class="category">{{ product.category.name }}</span>
                <h3>{{ product.name }}</h3>
                <p>{{ product.description|truncatewords:12 }}</p>
                <div class="rating">‚≠ê {{ product.average_rating|floatformat:1 }}</div>
                <div class="price">‚Çπ{{ product.price }}</div>
                <a href="{% url 'product_detail' product.id %}" class="btn">View Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<script>
// Star rating interactive effect
document.querySelectorAll('.star-label').forEach((star, index) => {
    star.addEventListener('mouseenter', () => {
        document.querySelectorAll('.star-label').forEach((s, i) => {
            s.style.color = i <= index ? '#f59e0b' : '#ddd';
        });
    });
    
    star.parentElement.addEventListener('click', () => {
        document.querySelectorAll('.star-label').forEach((s, i) => {
            s.style.color = i <= index ? '#f59e0b' : '#ddd';
        });
    });
});

document.querySelector('.star-rating-form').addEventListener('mouseleave', () => {
    const checkedRadio = document.querySelector('.star-radio:checked');
    if (checkedRadio) {
        const checkedIndex = Array.from(document.querySelectorAll('.star-radio')).indexOf(checkedRadio);
        document.querySelectorAll('.star-label').forEach((s, i) => {
            s.style.color = i <= checkedIndex ? '#f59e0b' : '#ddd';
        });
    } else {
        document.querySelectorAll('.star-label').forEach(s => s.style.color = '#ddd');
    }
});

window.addEventListener('load', () => {
    const checkedRadio = document.querySelector('.star-radio:checked');
    if (checkedRadio) {
        const checkedIndex = Array.from(document.querySelectorAll('.star-radio')).indexOf(checkedRadio);
        document.querySelectorAll('.star-label').forEach((s, i) => {
            s.style.color = i <= checkedIndex ? '#f59e0b' : '#ddd';
        });
    }
});
</script>


<script>
function changeImage(imageUrl) {
    const mainImage = document.getElementById("mainProductImage");
    mainImage.style.opacity = 0;
    setTimeout(() => {
        mainImage.src = imageUrl;
        mainImage.style.opacity = 1;
    }, 200);
}
</script>



{% endblock %}
