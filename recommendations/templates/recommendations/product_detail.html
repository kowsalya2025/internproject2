{% extends 'recommendations/base.html' %}
{% load static %}

{% block content %}
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .product-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px 20px;
    background: #fff;
  }

  .product-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 50px;
    margin-bottom: 50px;
  }

  /* Image Gallery Section */
  .image-gallery {
    display: flex;
    gap: 15px;
    position: sticky;
    top: 20px;
  }

  .thumbnail-column {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .thumbnail-img {
    width: 90px;
    height: 90px;
    object-fit: cover;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
    padding: 5px;
  }

  .thumbnail-img:hover {
    border-color: #2874f0;
    transform: scale(1.05);
  }

  .thumbnail-img.active {
    border-color: #2874f0;
    box-shadow: 0 0 8px rgba(40, 116, 240, 0.4);
  }

  .main-image-wrapper {
    flex: 1;
    position: relative;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    overflow: visible;
  }

  .main-image-container {
    position: relative;
    width: 100%;
    height: 650px;
    max-width: 650px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: crosshair;
     overflow: visible;
    border-radius: 12px;
  }

  .main-product-image {
   max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: opacity 0.3s ease;
  }

  /* ZOOM PANEL - Appears on the RIGHT side */
.zoomed-overlay {
  position: absolute;
  top: 0;
  left: calc(100% + 20px);
  width: 600px;
  height: 600px;
  overflow: hidden;
  border: 2px solid #2874f0;
  background: white;
  z-index: 999;
}

.zoomed-image {
  width: 200%;
  height: 200%;
  object-fit: contain;
  transform-origin: center;
}

  .zoomed-overlay.active {
    display: block;
  }

  .zoomed-overlay::before {
    content: 'üîç Zoomed View';
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(40, 116, 240, 0.9);
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    z-index: 10;
  }

  /* Product Info Section */
  .product-info {
    padding: 0 20px;
  }

  .product-title {
    font-size: 28px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 15px;
    line-height: 1.4;
  }

  .rating-section {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #e0e0e0;
  }

  .rating-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: #388e3c;
    color: white;
    padding: 5px 12px;
    border-radius: 4px;
    font-weight: 600;
    font-size: 14px;
  }

  .rating-count {
    color: #878787;
    font-size: 14px;
  }

  .stock-badge {
    display: inline-block;
    background: #e8f5e9;
    color: #388e3c;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 600;
    margin-bottom: 20px;
  }

  .price-section {
    margin-bottom: 25px;
  }

  .product-price {
    font-size: 36px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 10px;
  }

  .free-shipping {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: #fff3e0;
    color: #ff6f00;
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 500;
    font-size: 14px;
  }

  .info-card {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
  }

  .info-card-title {
    font-size: 18px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .info-card-text {
    color: #4a4a4a;
    line-height: 1.6;
    font-size: 15px;
  }

  .features-list {
    list-style: none;
  }

  .features-list li {
    padding: 10px 0;
    color: #4a4a4a;
    font-size: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .features-list li::before {
    content: "‚úì";
    color: #388e3c;
    font-weight: bold;
    font-size: 18px;
  }

  .action-buttons {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
  }

  .btn-primary {
    flex: 1;
    background: #ff9800;
    color: white;
    border: none;
    padding: 16px 30px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .btn-primary:hover {
    background: #f57c00;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
  }

  .btn-secondary {
    flex: 1;
    background: #2874f0;
    color: white;
    border: none;
    padding: 16px 30px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-secondary:hover {
    background: #1c5bbf;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(40, 116, 240, 0.3);
  }

  .btn-wishlist {
    background: white;
    border: 2px solid #e0e0e0;
    padding: 16px;
    border-radius: 8px;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-wishlist:hover {
    border-color: #ff4081;
    color: #ff4081;
    transform: scale(1.1);
  }

  .trust-badges {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 20px;
  }

  .trust-badge {
    text-align: center;
    padding: 20px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .trust-badge:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-3px);
  }

  .trust-icon {
    font-size: 32px;
    margin-bottom: 8px;
  }

  .trust-text {
    font-size: 13px;
    color: #4a4a4a;
    font-weight: 500;
  }

  .rating-form-section {
    background: #f8f9fa;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 30px;
    margin-bottom: 50px;
  }

  .section-title {
    font-size: 24px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .user-rating-display {
    background: #e8f5e9;
    color: #388e3c;
    padding: 12px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-weight: 500;
  }

  .star-rating {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-direction: row-reverse;
    justify-content: flex-end;
  }

  .star-rating input {
    display: none;
  }

  .star-rating label {
    font-size: 40px;
    color: #ddd;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .star-rating label:hover,
  .star-rating label:hover ~ label,
  .star-rating input:checked ~ label {
    color: #ffc107;
    transform: scale(1.1);
  }

  .submit-btn {
    background: #2874f0;
    color: white;
    border: none;
    padding: 14px 40px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .submit-btn:hover {
    background: #1c5bbf;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(40, 116, 240, 0.3);
  }

  .reviews-section {
    margin-bottom: 50px;
  }

  .review-card {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }

  .review-card:hover {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
  }

  .review-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
  }

  .reviewer-name {
    font-weight: 600;
    color: #212121;
    font-size: 16px;
    margin-bottom: 8px;
  }

  .review-stars {
    color: #ffc107;
    font-size: 18px;
  }

  .review-date {
    color: #878787;
    font-size: 13px;
  }

  .review-text {
    color: #4a4a4a;
    line-height: 1.6;
    font-size: 15px;
  }

  .no-reviews {
    text-align: center;
    padding: 60px 20px;
    background: #f8f9fa;
    border-radius: 12px;
  }

  .no-reviews-icon {
    font-size: 64px;
    margin-bottom: 20px;
  }

  .no-reviews-title {
    font-size: 22px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 10px;
  }

  .no-reviews-text {
    color: #878787;
    font-size: 15px;
  }

  .products-section {
    margin-bottom: 50px;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 30px;
  }

  .ai-badge {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 25px;
  }

  .product-card {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .product-card:hover {
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    transform: translateY(-5px);
  }

  .product-image {
    width: 100%;
    height: 220px;
    object-fit: cover;
    background: #f8f9fa;
  }

  .product-card-body {
    padding: 15px;
  }

  .product-category {
    color: #878787;
    font-size: 12px;
    text-transform: uppercase;
    margin-bottom: 5px;
  }

  .product-name {
    font-size: 16px;
    font-weight: 600;
    color: #212121;
    margin-bottom: 8px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .product-description {
    font-size: 13px;
    color: #878787;
    margin-bottom: 12px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .product-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .product-rating {
    color: #ffc107;
    font-size: 14px;
  }

  .product-price-small {
    font-size: 18px;
    font-weight: 700;
    color: #212121;
  }

  .view-btn {
    width: 100%;
    background: #2874f0;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .view-btn:hover {
    background: #1c5bbf;
  }

  /* Zoom instruction badge */
  .zoom-instruction {
    position: absolute;
    bottom: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    z-index: 10;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .main-image-wrapper:hover .zoom-instruction {
    opacity: 1;
  }

  @media (max-width: 1200px) {
    .zoomed-overlay {
      width: 400px;
      height: 450px;
    }
  }

  @media (max-width: 1024px) {
    .product-wrapper {
      grid-template-columns: 1fr;
    }

    .product-grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .zoomed-overlay {
      display: none !important;
    }

    .main-image-container {
      cursor: default;
    }
  }

  @media (max-width: 768px) {
    .image-gallery {
      flex-direction: column-reverse;
    }

    .thumbnail-column {
      flex-direction: row;
      overflow-x: auto;
    }

    .product-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .trust-badges {
      grid-template-columns: 1fr;
    }

    .action-buttons {
      flex-direction: column;
    }
  }

  @media (max-width: 480px) {
    .product-grid {
      grid-template-columns: 1fr;
    }
  }


  .product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 20px;
}

.product-card {
  background: #fff;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  transition: transform 0.3s ease;
  cursor: pointer;
}

.product-card:hover {
  transform: translateY(-4px);
}

.product-image {
  width: 100%;
  height: 200px;
  object-fit: cover;
  display: block;
}

.product-card-body {
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.product-category {
  font-size: 12px;
  color: #888;
}

.product-name {
  font-weight: 600;
  font-size: 16px;
}

.product-description {
  font-size: 13px;
  color: #555;
}

.product-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}

.product-price-small {
  font-weight: bold;
  color: #111;
}

.view-btn {
  margin-top: 10px;
  padding: 8px;
  background: #2874f0;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}







</style>

<div class="product-container">
  <div class="product-wrapper">
    <!-- Image Gallery - LEFT SIDE with 4 THUMBNAILS -->
    <div class="image-gallery">
      <div class="thumbnail-column">
        <!-- Image 1 -->
        {% if product.image1 %}
        <img 
          src="{{ product.image1.url }}" 
          alt="{{ product.name }} - View 1" 
          class="thumbnail-img active"
          data-full="{{ product.image1.url }}"
        >
        {% endif %}

        <!-- Image 2 -->
        {% if product.image2 %}
        <img 
          src="{{ product.image2.url }}" 
          alt="{{ product.name }} - View 2" 
          class="thumbnail-img"
          data-full="{{ product.image2.url }}"
        >
        {% endif %}

        <!-- Image 3 -->
        {% if product.image3 %}
        <img 
          src="{{ product.image3.url }}" 
          alt="{{ product.name }} - View 3" 
          class="thumbnail-img"
          data-full="{{ product.image3.url }}"
        >
        {% endif %}

        <!-- Image 4 -->
        {% if product.image4 %}
        <img 
          src="{{ product.image4.url }}" 
          alt="{{ product.name }} - View 4" 
          class="thumbnail-img"
          data-full="{{ product.image4.url }}"
        >
        {% endif %}
      </div>

      <!-- MAIN IMAGE - CENTER (hover here to zoom) -->
      <div class="main-image-wrapper">
        <div class="main-image-container" id="imageContainer">
          <img 
            src="{% if product.image1 %}{{ product.image1.url }}{% endif %}" 
            alt="{{ product.name }}" 
            class="main-product-image"
            id="mainImage"
          >
          <div class="zoom-instruction">üîç Hover to zoom</div>
        </div>

        <!-- ZOOMED VIEW - Appears on FAR RIGHT when hovering -->
        <div class="zoomed-overlay" id="zoomedView">
          <img 
            src="{% if product.image1 %}{{ product.image1.url }}{% endif %}" 
            alt="{{ product.name }} zoomed" 
            class="zoomed-image"
            id="zoomedImage"
          >
        </div>
      </div>
    </div>

    <!-- Product Info - RIGHT SIDE -->
    <div class="product-info">
      <h1 class="product-title">{{ product.name }}</h1>

      <div class="rating-section">
        <span class="rating-badge">
          ‚≠ê {{ product.average_rating|floatformat:1 }}
        </span>
        <span class="rating-count">{{ product.rating_count }} Ratings & Reviews</span>
      </div>

      <div class="stock-badge">‚úì In Stock</div>

      <div class="price-section">
        <div class="product-price">‚Çπ{{ product.price }}</div>
        <div class="free-shipping">
          <span>üöö</span>
          <span>Free Shipping on this item</span>
        </div>
      </div>

      <div class="info-card">
        <div class="info-card-title">üìù Description</div>
        <div class="info-card-text">{{ product.description }}</div>
      </div>

      <div class="info-card">
        <div class="info-card-title">‚ú® Key Features</div>
        <ul class="features-list">
          <li>Premium Quality Materials</li>
          <li>30-Day Money Back Guarantee</li>
          <li>Fast & Free Shipping</li>
          <li>24/7 Customer Support</li>
        </ul>
      </div>

      {% if user.is_authenticated %}
      <div class="action-buttons">

    <!-- ADD TO CART -->
    <form action="{% url 'add_to_cart' product.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn-primary">
            <span>üõí</span>
            <span>Add to Cart</span>
        </button>
    </form>

    <!-- WISHLIST -->
    <form action="{% url 'toggle_wishlist' product.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="btn-wishlist">
            ‚ù§Ô∏è
        </button>
    </form>

</div>
      {% else %}
      <a href="{% url 'login' %}" style="text-decoration: none;">
        <button class="btn-secondary" style="width: 100%;">
          üîê Login to Purchase
        </button>
      </a>
      {% endif %}

      <div class="trust-badges">
        <div class="trust-badge">
          <div class="trust-icon">üöö</div>
          <div class="trust-text">Fast Delivery</div>
        </div>
        <div class="trust-badge">
          <div class="trust-icon">üîí</div>
          <div class="trust-text">Secure Payment</div>
        </div>
        <div class="trust-badge">
          <div class="trust-icon">‚Ü©Ô∏è</div>
          <div class="trust-text">Easy Returns</div>
        </div>
      </div>
    </div>
  </div>

  {% if user.is_authenticated %}
  <div class="rating-form-section">
    <h3 class="section-title">‚≠ê Rate This Product</h3>
    
    {% if user_rating %}
    <div class="user-rating-display">
      ‚úì You rated this product {{ user_rating.score }}/5 stars
    </div>
    {% endif %}

    <form method="post" action="{% url 'rate_product' product.id %}">
      {% csrf_token %}
      <div class="star-rating">
        {% for i in "12345" %}
        <input 
          type="radio" 
          name="score" 
          value="{{ forloop.counter }}" 
          id="star{{ forloop.counter }}"
          {% if user_rating.score == forloop.counter %}checked{% endif %}
        >
        <label for="star{{ forloop.counter }}">‚≠ê</label>
        {% endfor %}
      </div>
      <button type="submit" class="submit-btn">Submit Rating</button>
    </form>
  </div>
  {% endif %}

  <div class="reviews-section">
    <h3 class="section-title">üí¨ Customer Reviews ({{ product.rating_count }})</h3>
    
    {% if ratings %}
      {% for rating in ratings %}
      <div class="review-card">
        <div class="review-header">
          <div>
            <div class="reviewer-name">{{ rating.user.username }}</div>
            <div class="review-stars">
              {% for i in "12345" %}
                {% if forloop.counter <= rating.score %}‚≠ê{% else %}‚òÜ{% endif %}
              {% endfor %}
            </div>
          </div>
          <div class="review-date">{{ rating.created_at|date:"M d, Y" }}</div>
        </div>
        {% if rating.review %}
        <div class="review-text">{{ rating.review }}</div>
        {% endif %}
      </div>
      {% endfor %}
    {% else %}
    <div class="no-reviews">
      <div class="no-reviews-icon">üí≠</div>
      <div class="no-reviews-title">No Reviews Yet</div>
      <div class="no-reviews-text">Be the first to review this product!</div>
    </div>
    {% endif %}
  </div>

  {% if similar_products %}
  <div class="products-section">
    <div class="section-header">
      <h3 class="section-title">üîç Similar Products</h3>
    </div>
    <div class="product-grid">
      {% for product in similar_products %}
      <div class="product-card" onclick="window.location.href='{% url 'product_detail' product.id %}'">
        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
        <div class="product-card-body">
          <div class="product-category">{{ product.category.name }}</div>
          <div class="product-name">{{ product.name }}</div>
          <div class="product-description">{{ product.description|truncatewords:12 }}</div>
          <div class="product-footer">
            <span class="product-rating">‚≠ê {{ product.average_rating|floatformat:1 }}</span>
            <span class="product-price-small">‚Çπ{{ product.price }}</span>
          </div>
          <button class="view-btn">View Details</button>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  {% if recommendations %}
  <div class="products-section">
    <div class="section-header">
      <h3 class="section-title">üéØ Recommended For You</h3>
      <span class="ai-badge">AI Powered</span>
    </div>
    <div class="product-grid">
      {% for product in recommendations %}
      <div class="product-card" onclick="window.location.href='{% url 'product_detail' product.id %}'">
         <div class="product-image-box">
    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
</div>

        <div class="product-card-body">
          <div class="product-category">{{ product.category.name }}</div>
          <div class="product-name">{{ product.name }}</div>
          <div class="product-description">{{ product.description|truncatewords:12 }}</div>
          <div class="product-footer">
            <span class="product-rating">‚≠ê {{ product.average_rating|floatformat:1 }}</span>
            <span class="product-price-small">‚Çπ{{ product.price }}</span>
          </div>
          <button class="view-btn">View Details</button>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const thumbnails = document.querySelectorAll(".thumbnail-img");
  const mainImage = document.getElementById("mainImage");
  const zoomBox = document.getElementById("zoomedView");
  const zoomImage = document.getElementById("zoomedImage");
  const imageContainer = document.querySelector(".main-image-container");

  if (!mainImage || !zoomImage || !imageContainer) return;

  // ---------- THUMBNAIL CLICK ----------
  thumbnails.forEach(thumbnail => {
    thumbnail.addEventListener("click", function () {
      const newSrc = this.getAttribute("data-full");

      if (!newSrc) return;

      // Update images
      mainImage.src = newSrc;
      zoomImage.src = newSrc;

      // Active thumbnail highlight
      thumbnails.forEach(t => t.classList.remove("active"));
      this.classList.add("active");
    });
  });

  // ---------- ZOOM SHOW ----------
  imageContainer.addEventListener("mouseenter", () => {
    if (window.innerWidth > 1024) {
      zoomBox.style.display = "block";
    }
  });

  imageContainer.addEventListener("mouseleave", () => {
    zoomBox.style.display = "none";
    zoomImage.style.transform = "scale(1)";
  });

  // ---------- ZOOM MOVE ----------
  imageContainer.addEventListener("mousemove", (e) => {
    if (window.innerWidth <= 1024) return;

    const rect = imageContainer.getBoundingClientRect();

    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;

    zoomImage.style.transformOrigin = `${x}% ${y}%`;
    zoomImage.style.transform = "scale(2)";
  });

});
</script>



{% endblock %}
