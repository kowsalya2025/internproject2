{% extends 'recommendations/base.html' %}

{% block title %}My Recommendations - SmartShop{% endblock %}

{% block content %}
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; border-radius: 12px; margin: 30px 0;">
    <h1 style="font-size: 2.2em; margin-bottom: 10px;">üéØ Personalized For You</h1>
    <p style="font-size: 1.1em; opacity: 0.95;">Based on your browsing history, ratings, and purchases</p>
</div>

{% if recent_purchases %}
<div style="background: white; padding: 30px; border-radius: 12px; margin: 30px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="color: #2c3e50; margin-bottom: 20px;">üì¶ Your Recent Purchases</h2>
    <div style="display: grid; gap: 15px;">
        {% for purchase in recent_purchases %}
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <div>
                <strong style="color: #2c3e50;">{{ purchase.product.name }}</strong>
                <span style="color: #666; margin-left: 15px;">Qty: {{ purchase.quantity }}</span>
            </div>
            <div>
                <span style="color: #27ae60; font-weight: bold;">${{ purchase.product.price }}</span>
                <span style="color: #999; margin-left: 15px; font-size: 0.9em;">{{ purchase.purchased_at|date:"M d, Y" }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if personalized_recommendations %}
<h2 class="section-title">‚ú® Recommended Just For You</h2>
<p style="color: #666; margin-bottom: 20px;">Based on your preferences and similar users' choices</p>
<div class="product-grid">
    {% for product in personalized_recommendations %}
    <div class="product-card">

        <!-- ‚≠ê ADD IMAGE HERE ‚≠ê -->
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}" 
             style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
        {% endif %}

        <h3>{{ product.name }}</h3>
        <span class="category">{{ product.category.name }}</span>
        <p>{{ product.description|truncatewords:12 }}</p>
        <div class="rating">‚≠ê {{ product.average_rating|floatformat:1 }}</div>
        <div class="price">${{ product.price }}</div>
        <a href="{% url 'product_detail' product.id %}" class="btn">View Details ‚Üí</a>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="alert alert-info">
    <h3>üéÅ Start Your Journey!</h3>
    <p>We need a bit more information to personalize recommendations for you.</p>
    <p style="margin-top: 10px;">
        <strong>Quick tips:</strong><br>
        ‚Ä¢ Browse and rate products<br>
        ‚Ä¢ Make a few purchases<br>
        ‚Ä¢ Our AI will learn your preferences!
    </p>
    <a href="/" class="btn" style="margin-top: 15px;">Explore Products</a>
</div>
{% endif %}

{% if popular_products %}
<h2 class="section-title">üî• Trending Products</h2>
<p style="color: #666; margin-bottom: 20px;">Most popular items right now</p>
<div class="product-grid">
    {% for product in popular_products %}
    <div class="product-card">

        <!-- ‚≠ê ADD IMAGE HERE TOO ‚≠ê -->
        {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.name }}" 
             style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
        {% endif %}

        <h3>{{ product.name }}</h3>
        <span class="category">{{ product.category.name }}</span>
        <p>{{ product.description|truncatewords:12 }}</p>
        <div class="rating">‚≠ê {{ product.average_rating|floatformat:1 }}</div>
        <div class="price">${{ product.price }}</div>
        <a href="{% url 'product_detail' product.id %}" class="btn">View Details ‚Üí</a>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
